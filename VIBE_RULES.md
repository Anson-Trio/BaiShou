# ç™½å®ˆ (BaiShou) - VIBE & å¼€å‘è§„çº¦

> **"ä»¥çº¯ç™½çš„èª“çº¦ï¼Œå®ˆæŠ¤å½¼æ­¤çš„ä¸€ç”Ÿã€‚"**
> æ­¤æ–‡æ¡£å®šä¹‰äº†ç™½å®ˆï¼ˆBaiShouï¼‰é¡¹ç›®çš„ä»£ç é£æ ¼ã€æ¶æ„è§„èŒƒä¸æ ¸å¿ƒç²¾ç¥ã€‚
> æ‰€æœ‰çš„æ³¨é‡Šä¸è¯´æ˜æ–‡æœ¬å¼ºåˆ¶ä½¿ç”¨ **ä¸­æ–‡** ä¹¦å†™ã€‚

---

## 1. æ ¸å¿ƒç²¾ç¥ (The Vibe)

- **çº¯ç²¹ (Purity)**: ä»£ç é€»è¾‘å¿…é¡»åƒ"ç™½å®ˆ"çš„åå­—ä¸€æ ·å¹²å‡€ã€çº¯ç²¹ã€‚æ‹’ç»è¿‡åº¦å°è£…ï¼Œæ‹’ç»é¢æ¡ä»£ç ã€‚
- **ç¨³å›º (Stability)**: æˆ‘ä»¬å®ˆæŠ¤çš„æ˜¯ç”¨æˆ·çš„**è®°å¿†**ã€‚æ•°æ®å±‚ï¼ˆData Layerï¼‰å¿…é¡»æå…¶å¥å£®ï¼Œç»ä¸å…è®¸ä¸¢å¤±ç”¨æˆ·çš„ä¸€ä¸ªå­—ç¬¦ã€‚
- **æ¸©æš– (Warmth)**: UI äº¤äº’åº”å¸¦æœ‰å¾®å°çš„çµåŠ¨æ„Ÿï¼ˆMicro-interactionsï¼‰ã€‚å³ä½¿æ˜¯ MVP ç‰ˆæœ¬ï¼ŒåŸºç¡€çš„åŠ¨ç”»æ›²çº¿ï¼ˆCurvesï¼‰å’Œè½¬åœºä¹Ÿåº”è‡ªç„¶æµç•…ï¼ˆSakura's Requestï¼‰ã€‚
- **ç†æ€§ (Logic)**: æ¶æ„åˆ†å±‚ä¸¥æ˜ï¼ŒçŠ¶æ€ç®¡ç†æ¸…æ™°ã€‚ä»»ä½•å‰¯ä½œç”¨ï¼ˆSide Effectsï¼‰å¿…é¡»å¯è¿½è¸ªï¼ˆAkatsuki's Mandateï¼‰ã€‚

---

## 2. æŠ€æœ¯æ ˆ (Tech Stack)

| é¢†åŸŸ           | é€‰å‹                     | è¯´æ˜                                                 |
| :------------- | :----------------------- | :--------------------------------------------------- |
| **Framework**  | **Flutter 3.x**          | å…¨å¹³å°ç»Ÿä¸€ä½“éªŒ                                       |
| **Language**   | **Dart 3.x**             | å¼€å¯ 100% ç©ºå®‰å…¨ï¼Œä½¿ç”¨ Records, Patterns ç­‰æ–°ç‰¹æ€§    |
| **State Mgmt** | **Riverpod (Generator)** | ä½¿ç”¨ `@riverpod` æ³¨è§£ç”Ÿæˆä»£ç ï¼Œæ‹’ç»æ‰‹åŠ¨ç¼–å†™ Provider |
| **Database**   | **Drift**                | ç±»å‹å®‰å…¨çš„ SQLite å°è£…ï¼Œè¿™ä¹Ÿæ˜¯ä¸ºäº†æ•°æ®çš„ç¨³å›ºæ€§       |
| **Routing**    | **GoRouter**             | å£°æ˜å¼è·¯ç”±ç®¡ç†                                       |
| **UI System**  | **Material Design 3**    | ä½¿ç”¨å®˜æ–¹ M3 è§„èŒƒï¼Œé…è‰²éœ€ç¬¦åˆ"ç™½å®ˆ"çš„ç´ é›…æ·¡æ´         |
| **Immutable**  | **Freezed**              | æ•°æ®ç±»å¿…é¡»ä¸å¯å˜ï¼Œæœç»éšå¼çŠ¶æ€ä¿®æ”¹                   |
| **AI Client**  | **Google Generative AI** | ç›´æ¥è°ƒç”¨ Gemini API (MVPé˜¶æ®µ)                        |
| **I18n**       | **slang**                | å¼ºç±»å‹ç¿»è¯‘é”®ï¼Œä»£ç ç”Ÿæˆï¼Œæ”¯æŒå‚æ•°æ’å€¼ï¼Œé›¶è¿è¡Œæ—¶åå°„ |

---

## 3. é¡¹ç›®æ¶æ„ (Architecture)

é‡‡ç”¨ **Feature-First + Riverpod Architecture** åˆ†å±‚ç»“æ„ã€‚

```text
lib/
â”œâ”€â”€ app.dart                # åº”ç”¨å…¥å£ widget
â”œâ”€â”€ bootstrap.dart          # å¯åŠ¨é€»è¾‘ï¼ˆæ—¥å¿—ã€Crashlyticsç­‰ï¼‰
â”œâ”€â”€ main.dart               # main å‡½æ•°
â”œâ”€â”€ core/                   # æ ¸å¿ƒé€šç”¨æ¨¡å—
â”‚   â”œâ”€â”€ theme/              # ä¸»é¢˜é…ç½® (Sakura's Palette)
â”‚   â”œâ”€â”€ constants/          # å¸¸é‡ (API keys, constraints)
â”‚   â”œâ”€â”€ utils/              # é€šç”¨å·¥å…·
â”‚   â”œâ”€â”€ database/           # Drift æ•°æ®åº“é…ç½®
â”‚   â””â”€â”€ router/             # GoRouter é…ç½®
â”œâ”€â”€ features/               # ä¸šåŠ¡æ¨¡å— (æŒ‰åŠŸèƒ½åˆ’åˆ†)
â”‚   â”œâ”€â”€ diary/              # e.g. æ—¥è®°æ¨¡å—
â”‚   â”‚   â”œâ”€â”€ data/           # Data Layer (Repository, DTOs, Sources)
â”‚   â”‚   â”œâ”€â”€ domain/         # Domain Layer (Entities, Logic)
â”‚   â”‚   â””â”€â”€ presentation/   # Presentation Layer (Widgets, Controllers)
â”‚   â”œâ”€â”€ summary/            # e.g. æ€»ç»“æ¨¡å—
â”‚   â””â”€â”€ settings/           # e.g. è®¾ç½®æ¨¡å—
â”œâ”€â”€ i18n/                   # å›½é™…åŒ–æ–‡ä»¶ç›®å½• (slang ç®¡ç†)
â”‚   â”œâ”€â”€ zh.i18n.json           # ç®€ä½“ä¸­æ–‡ï¼ˆåŸºç¡€è¯­è¨€ï¼ŒBase Localeï¼‰
â”‚   â”œâ”€â”€ zh_TW.i18n.json        # ç¹ä½“ä¸­æ–‡
â”‚   â”œâ”€â”€ en.i18n.json           # è‹±è¯­
â”‚   â”œâ”€â”€ ja.i18n.json           # æ—¥è¯­
â”‚   â””â”€â”€ strings.g.dart         # slang è‡ªåŠ¨ç”Ÿæˆï¼Œç¦æ­¢æ‰‹åŠ¨ä¿®æ”¹
â””â”€â”€ source/
    â””â”€â”€ prompts/               # AI æç¤ºè¯æ¨¡æ¿ï¼ˆæŒ‰ Locale åˆ†å‘ï¼‰
```

### 3.1 ä¸¥æ ¼åˆ†å±‚åŸåˆ™

- **Presentation Layer** åªèƒ½è°ƒç”¨ **Application/Service Layer** æˆ– **Providers**ã€‚
- **UI Widget** ä¸¥ç¦åŒ…å«å¤æ‚ä¸šåŠ¡é€»è¾‘ï¼Œå¿…é¡»å§”æ‰˜ç»™ `AsyncNotifier` æˆ– `Controller`ã€‚
- **Data Layer** ä¸¥ç¦ç›´æ¥æš´éœ²ç»™ UIï¼Œå¿…é¡»é€šè¿‡ Repository æ¥å£ã€‚

---

## 4. ç¼–ç è§„èŒƒ (Coding Standards)

### 4.1 Riverpod è§„èŒƒ

- **å¼ºåˆ¶ä½¿ç”¨ Code Generation**:

  ```dart
  // âœ… Good
  @riverpod
  String hello(Ref ref) => 'Hello';

  // âŒ Bad
  final helloProvider = Provider((ref) => 'Hello');
  ```

- **Controller å‘½å**: ä½¿ç”¨ `XxxController` æˆ– `XxxNotifier`ã€‚
- **State å‘½å**: çŠ¶æ€ç±»å°½é‡ä½¿ç”¨ Freezed å®šä¹‰ã€‚

### 4.2 UI å¼€å‘è§„èŒƒ (Sakura's Aesthetic)

- **æ‹†åˆ†ç»„ä»¶**: è¶…è¿‡ 100 è¡Œçš„ `build` æ–¹æ³•å¿…é¡»æ‹†åˆ†ä¸ºå°ç»„ä»¶ã€‚
- **å¸¸é‡æŠ½å–**: æ‰€æœ‰çš„ Padding, Spacing, Colors å¿…é¡»å¼•ç”¨ `Theme.of(context)` æˆ–å¸¸æ•°æ–‡ä»¶ï¼Œç¦æ­¢ç¡¬ç¼–ç  Magic Numberã€‚
- **ä¸­æ–‡å­—ä½“**: ç¡®ä¿ Android/iOS ä¸‹ä¸­æ–‡å­—ä½“æ˜¾ç¤ºä¼˜åŒ–ï¼Œä¼˜å…ˆä½¿ç”¨åœ†ä½“æˆ–è¡¬çº¿ä½“ä»¥ä½“ç°"æ—¥è®°"çš„æ–‡å­¦æ„Ÿã€‚

### 4.3 å¼‚å¸¸å¤„ç† (Akatsuki's Shield)

- ä½¿ç”¨ `AsyncValue` å¤„ç†åŠ è½½ä¸é”™è¯¯çŠ¶æ€ã€‚
- **Error Handling**: æ‰€æœ‰çš„ Repository æ–¹æ³•åº”æ•è·åº•å±‚å¼‚å¸¸ï¼ˆå¦‚ SQLite å¼‚å¸¸ï¼‰å¹¶è½¬æ¢ä¸º App ç»Ÿä¸€çš„ `Failure` ç±»ã€‚
- **Logging**: å…³é”®è·¯å¾„å¿…é¡»æ‰“ Logï¼Œä½†ç¦æ­¢åœ¨ç”Ÿäº§ç¯å¢ƒè¾“å‡ºæ•æ„Ÿæ•°æ®ï¼ˆæ—¥è®°å†…å®¹ï¼‰ã€‚

---

## 5. æ•°æ®æ¨¡å‹ä¸æ•°æ®åº“ (Data & DB)

### 5.1 Drift Table å®šä¹‰

- è¡¨åä½¿ç”¨ **è›‡å½¢å‘½åæ³• (snake_case)**ã€‚
- æ‰€æœ‰è¡¨å¿…é¡»åŒ…å« `created_at` å’Œ `updated_at`ã€‚
- æ—¥è®°è¡¨ `diaries` å¿…é¡»å¯¹ `date` å­—æ®µå»ºç«‹ç´¢å¼•ã€‚

### 5.2 JSON åºåˆ—åŒ–

- ä½¿ç”¨ `json_serializable` å’Œ `freezed`ã€‚
- æ‰€æœ‰çš„ API å“åº”æ¨¡å‹æ”¾åœ¨ `data/models` ä¸‹ã€‚
- æ‰€æœ‰çš„ä¸šåŠ¡å®ä½“æ¨¡å‹æ”¾åœ¨ `domain/entities` ä¸‹ã€‚

---

## 6. Git å·¥ä½œæµ (Workflow)

éµå¾ª **Conventional Commits**ï¼š

- `feat`: âœ¨ æ–°åŠŸèƒ½ (Sparkles for Sakura)
- `fix`: ğŸ› ä¿®å¤ Bug
- `refactor`: â™»ï¸ é‡æ„
- `docs`: ğŸ“ æ–‡æ¡£
- `chore`: ğŸ”§ é…ç½®ä¿®æ”¹

**Commit ç¤ºä¾‹**:
`feat(diary): å¢åŠ æ—¥è®°ç¼–è¾‘é¡µé¢çš„ Markdown é¢„è§ˆåŠŸèƒ½`

---

## 7. AI åä½œæŒ‡ä»¤ (Instructions for AI)

å½“ä½ ï¼ˆAIï¼‰ç¼–å†™ä»£ç æ—¶ï¼š

1. **ä¼˜å…ˆç”Ÿæˆå®Œæ•´ä»£ç **ï¼šä¸è¦åªç»™ç‰‡æ®µï¼Œå°½é‡ç»™å‡ºå¯ç›´æ¥è¿è¡Œçš„å®Œæ•´æ–‡ä»¶æˆ–ç±»ã€‚
2. **æ£€æŸ¥ Import**ï¼šç¡®ä¿ import è·¯å¾„æ­£ç¡®ï¼Œä¼˜å…ˆä½¿ç”¨ç»å¯¹è·¯å¾„ `package:baishou/...`ã€‚
3. **è§£é‡Šé€»è¾‘**ï¼šåœ¨å¤æ‚é€»è¾‘å¤„ï¼ˆå°¤å…¶æ˜¯ Riverpod çš„çŠ¶æ€æµè½¬ï¼‰ï¼Œç”¨æ³¨é‡Šè§£é‡Šæ¸…æ¥šã€‚
4. **UI å¾®è°ƒ**ï¼šåœ¨ç¼–å†™ UI æ—¶ï¼Œä¸»åŠ¨æ·»åŠ  `const` ä¿®é¥°ç¬¦ï¼Œä¸»åŠ¨æ€è€ƒ Padding å’Œå¯¹é½ï¼Œç¡®ä¿ visually pleasingã€‚
5. **I18n ä¼˜å…ˆ**ï¼šæ‰€æœ‰æ–°å¢ UI æ–‡æ¡ˆå¿…é¡»å…ˆåœ¨ `lib/i18n/strings_zh.i18n.json` ä¸­å®šä¹‰ï¼Œå†é€šè¿‡ `t.xxx.xxx` è®¿é—®ï¼Œç¦æ­¢ç¡¬ç¼–ç ä¸­æ–‡å­—é¢é‡ã€‚

---

## 8. å›½é™…åŒ–è§„èŒƒ (I18n - slang)

### 8.1 æŠ€æœ¯é€‰å‹ï¼šslang

æˆ‘ä»¬ä½¿ç”¨ [slang](https://pub.dev/packages/slang) ä½œä¸º I18n è§£å†³æ–¹æ¡ˆã€‚å®ƒåŸºäºä»£ç ç”Ÿæˆè€Œéè¿è¡Œæ—¶åå°„ï¼Œå¤©ç„¶ç±»å‹å®‰å…¨ï¼Œä¸”å¯¹ Flutter å…¨å¹³å°æ”¯æŒå®Œç¾ã€‚

ä»¥ä¸‹å‡ ç‚¹å†³å®šäº†é€‰æ‹©å®ƒçš„ä»·å€¼ï¼š
- **å¼ºç±»å‹è®¿é—®**ï¼š`t.summary.dashboard_title` ç¼–è¯‘æœŸæŠ¥é”™ï¼Œè€Œéè¿è¡Œæ—¶ KeyNotFoundã€‚
- **å‚æ•°æ’å€¼**ï¼š`t.summary.lookback_period(months: 12)` ç›´æ¥ä¼ å‚ï¼Œè¯­æ³•æ¸…æ™°ã€‚
- **æ— éœ€ Context**ï¼šå¯ä»¥åœ¨ Service å±‚ç›´æ¥é€šè¿‡ `t.xxx` æˆ– `LocaleSettings.currentLocale` è®¿é—®ç¿»è¯‘ã€‚

### 8.2 æ–‡ä»¶ç»“æ„

`lib/i18n/` ç›®å½•ä¸‹åŒ…å«æ‰€æœ‰ç¿»è¯‘ JSON æ–‡ä»¶ã€‚**ç®€ä½“ä¸­æ–‡ï¼ˆ`zh.i18n.json`ï¼‰æ˜¯åŸºç¡€è¯­è¨€ï¼ˆBase Localeï¼‰**ï¼Œå…¶ä»–è¯­è¨€æ–‡ä»¶ä»…éœ€è¦†ç›–ä¸åŒçš„é”®å€¼ã€‚

æ”¯æŒè¯­è¨€ï¼š
| è¯­è¨€ | æ–‡ä»¶ | Locale æšä¸¾ |
|:---|:---|:---|
| ç®€ä½“ä¸­æ–‡ | `zh.i18n.json` | `AppLocale.zh` |
| ç¹ä½“ä¸­æ–‡ | `zh_TW.i18n.json` | `AppLocale.zhTw` |
| è‹±è¯­ | `en.i18n.json` | `AppLocale.en` |
| æ—¥è¯­ | `ja.i18n.json` | `AppLocale.ja` |

### 8.3 ä½¿ç”¨è§„èŒƒ

**â‘  UI æ–‡æ¡ˆï¼šåœ¨ Widget ä¸­ä½¿ç”¨ `t`**
```dart
// âœ… Good
Text(t.summary.copy_memories)

// âŒ Badï¼ˆç¡¬ç¼–ç ä¸­æ–‡ï¼Œæ— æ³•å¤šè¯­è¨€ï¼‰
Text('å¤åˆ¶å…±åŒå›å¿†')
```

**â‘¡ å¸¦å‚æ•°çš„ç¿»è¯‘**
```dart
// JSON å®šä¹‰ï¼š"lookback_period": "è¿‡å» {months} ä¸ªæœˆ"
// slang å°†æ’å€¼å­—ç¬¦ä¸²ç”Ÿæˆä¸ºæ™®é€š String getterï¼Œéœ€æ‰‹åŠ¨æ›¿æ¢å ä½ç¬¦ï¼š
Text(t.summary.lookback_period.replaceAll('{months}', '$months'))
```

> [!NOTE]
> **å…³äºå‚æ•°æ’å€¼**ï¼šslang ä»…å½“ JSON ä¸­å­˜åœ¨ `(param)` æˆ–ä½¿ç”¨äº† plurals è¯­æ³•æ—¶ï¼Œæ‰ä¼šç”Ÿæˆå‡½æ•°å½¢å¼ã€‚
> ä½¿ç”¨ `{param}` é£æ ¼æ—¶ï¼Œç”Ÿæˆçš„æ˜¯ `String get`ï¼Œéœ€åœ¨ä»£ç ä¸­æ‰‹åŠ¨ `replaceAll('{param}', value)` æ›¿æ¢ã€‚

**â‘¢ åœ¨ Service å±‚ï¼ˆé Widget å±‚ï¼‰ä½¿ç”¨ç¿»è¯‘**
```dart
// ä¸éœ€è¦ BuildContextï¼Œç›´æ¥é€šè¿‡é¡¶å±‚ t æˆ–è·å–å½“å‰ Locale
final currentLocale = LocaleSettings.currentLocale;
final prompt = PromptTemplates.buildWeekly(currentLocale, ...);
```

**â‘£ åˆ‡æ¢è¯­è¨€**
```dart
await LocaleSettings.setLocale(AppLocale.en);
```

### 8.4 æ–°å¢ç¿»è¯‘æ–‡æ¡ˆçš„æµç¨‹

1. åœ¨ `strings_zh.i18n.json` ä¸­å¢åŠ å¯¹åº”é”®ã€‚
2. åœ¨å…¶ä»–ä¸‰ä¸ªè¯­è¨€æ–‡ä»¶ï¼ˆ`zh_TW`, `en`, `ja`ï¼‰ä¸­åŒæ­¥å¢åŠ ç¿»è¯‘ã€‚
3. è¿è¡Œ `dart run build_runner build --delete-conflicting-outputs` é‡æ–°ç”Ÿæˆä»£ç ã€‚
4. åœ¨ UI ä¸­é€šè¿‡ `t.xxx.yyy` è®¿é—®ï¼ˆIDE ä¼šæç¤ºè‡ªåŠ¨è¡¥å…¨ï¼‰ã€‚

> [!IMPORTANT]
> **æ¯æ¬¡ä¿®æ”¹ `.i18n.json` åå¿…é¡»é‡æ–°æ‰§è¡Œ build_runnerï¼** å¦åˆ™ç”Ÿæˆçš„ `strings.g.dart` ä¸ä¼šæ›´æ–°ï¼Œ`t.xxx.xxx` ä¼šæŠ¥ç¼–è¯‘é”™è¯¯ã€‚
